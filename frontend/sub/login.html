<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KRaft</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
      function sleep(ms) {
          return new Promise(resolve => setTimeout(resolve, ms));
      }

      function submitForm() {
        // const username = document.getElementById('username').value;
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        console.log("meow");

        fetch('/auth/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ email, password })
        })
        .then(async response => {
          let data = {}
          try {
            data = await response.clone().json();

            if (!data.error){
              document.getElementById('error-message').textContent = 'Success!';
              sleep(2000);
              window.location.href = `/`;
            }
          }
          catch (error) {
            console.log("error");
            data = { message: await response.text() };
          }

          if (!response.ok) {
            console.log(data);
            document.getElementById('error-message').textContent = data.message
          }
        })



        // fetch('https://kraft.alexbissessur.dev/auth/login', {
        //   method: 'POST',
        //   headers: {
        //     'Content-Type': 'application/json'
        //   },
        //   body: JSON.stringify({ email, password })
        // })
        // .then(response => response.json())
        // .then(data => {
        //   if (data.error) {
        //     document.getElementById('error-message').textContent = data.error;
        //   } else {
        //     document.getElementById('error-message').textContent = 'Success!';

        //     sleep(2000);
        //     window.location.href = `/`;
        //     // redirect to home
        //     // window.location.href = `/`;
        //   }
        // })
        // .catch(error => {
        //   document.getElementById('error-message').textContent = 'An error occurred somewhere between here and the server.';
        //   console.error('Error:', error);
        // });
        return false;

      }
    </script>

</head>
<body class="bg-black h-screen w-screen flex items-center justify-center m-0 p-0">
    <div class=" m-8 rounded-md shadow-lg max-w-2xl w-full mx-4 outline-white-500 h-[60vh]">
        <!-- bg-zinc-800 -->
        <div class="flex items-center mb-4">
            <a href="/"><h1 class="text-white font-mono text-3xl">KRaft</h1></a>
            <h3 class="text-white font-mono text-sm ml-2 self-end mb-1">by Alex</h3>
        </div>
        <div class="text-white font-mono flex flex-col mt-8">
            <a href="#" class="text-2xl underline block">> Login</a>
        </div>
        <!-- login form -->
        <form class="text-white text-xl font-mono flex flex-col mt-8" onsubmit="return submitForm();">
            <label for="email">Email :</label><br>
            <input class="text-gray-800" type="text" id="email" name="email" required><br>

            <label for="password">Password :</label><br>
            <input class="text-gray-800" type="password" id="password" name="password" required>

            <input type="submit" value="Submit">
        </form>

        <div class="text-white font-mono flex flex-col mt-8 text-right">
            <a href="./register.html" class="text-2xl underline block">Register <</a>
        </div>

        <div class="text-2xl bg-red-300 font-mono mt-8 text-center" id="error-message">
            <!-- will be filled with error message -->
        </div>
    </div>
</body>
</html>
